name: Build and Deploy

on:
  push:
    branches:
      - main  # Or your deployment branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v3

      - name: 🔧 Set up Node.js 18.17.0
        uses: actions/setup-node@v4
        with:
          node-version: 18.17.0

      - name: 🐍 Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: 3.11

      - name: 🧪 Install Python dependencies (optional)
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # - name: 📦 Install UI dependencies and build
      #   working-directory: ui/litellm-dashboard
      #   run: |
      #     npm install
      #     npm run build

      - name: 📂 Upload UI build artifact
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: litellm-dashboard-build
          path: ui/litellm-dashboard/.next/

      - name: 🐳 Log in to Docker Hub
        run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

      - name: 🛠️ Build Docker image
        run: docker build -f ui/litellm-dashboard/Dockerfile -t ${{ secrets.DOCKER_USERNAME }}/llm:latest .

      - name: 🚀 Push Docker image to Docker Hub
        run: docker push ${{ secrets.DOCKER_USERNAME }}/llm:latest


# name: Build and Deploy 

# on:
#   push:
#     branches:
#       - main  # Change to your deployment branch if needed

# jobs:
#   deploy:
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v3

#       - name: Set up Node.js 18.17.0
#         uses: actions/setup-node@v4
#         with:
#           node-version: 18.17.0

#       - name: Set up Python 3.11
#         uses: actions/setup-python@v5
#         with:
#           python-version: 3.11

#       - name: Install Python dependencies
#         run: |
#           python -m pip install --upgrade pip
#           if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

#       - name: 📦 Install UI dependencies and build
#         working-directory: ui/litellm-dashboard
#         run: |
#           npm install
#           npm run build

#       - name: 📂 Upload build artifact
#         if: success()
#         uses: actions/upload-artifact@v4
#         with:
#           name: litellm-dashboard-build
#           path: ui/litellm-dashboard/.next/

#       - name: Log in to Docker Hub
#         run: echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
#       - name: Build Docker image
#         run: docker build -t ${{ secrets.DOCKER_USERNAME }}/llm:latest .

#       - name: Push Docker image to Docker Hub
#         run: docker push ${{ secrets.DOCKER_USERNAME }}/llm:latestm
